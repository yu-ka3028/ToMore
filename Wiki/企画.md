# To-Want(仮)

## 　概要

- QOL を上げるために Rails やりたくなった。
- システム設計と要件定義まわりを 4 月までにイメージつけたい。

### 目的

- ユーザーが「やりたいこと」を管理
  - 既存の予定（Google カレンダー連携）と調整しながら実現

### 背景

- QOL を上げたい
  - やること、じゃなくてやりたいことをやる時間を捻出する

### 2. システム概要

#### 利用技術

| 技術           |                                               |
| -------------- | --------------------------------------------- |
| フレームワーク | Rails 8                                       |
| データベース   | SQLite（Litestream でバックアップ機能を強化） |
| デプロイ環境   | Google Cloud Run                              |
| 外部 API       | Google Calendar API                           |
| gem | gem 'omniauth' |
| | gem 'omniauth-google-oauth2'|


#### システム構成図

```
ユーザー端末
   ↓
To-Wantアプリ (Rails 8)
+  ├─ Google OAuth 2.0（認証）
   └─ Google Calendar API（データ連携）
   ↓
SQLite + Litestream(データ永続化)
```

#### 3.1 基本機能

- OAuth 2.0 によるログイン:<br>

  - Google アカウントを用いたシングルサインオン（SSO）実装
  - 必要なスコープ: email, profile, https://www.googleapis.com/auth/calendar.readonly

- ユーザー情報同期:<br>

  - 初回ログイン時に基本プロフィール（名前/メール）を自動取得
  - セッション管理機能（30 日間保持）

- セキュリティ対策:<br>

  - CSRF 対策トークンの実装
  - トークンの有効期限管理（リフレッシュトークン対応）

- To-Want リスト管理機能:<br>

  - ユーザーが「やりたいこと」を登録・編集・削除。
  - 優先順位（高、中、低）の設定。
  - 完了済みタスクのチェック機能。

- Google カレンダー連携機能:

  - Google Calendar API から既存予定を取得。
  - 予定の優先順位付け（絶対必要〜調整可能）。
  - 必要に応じた予定の編集・削除。

- 通知機能:<br>

  - 優先度に応じたリマインダー通知（メールまたはプッシュ通知）。

- データ同期とバックアップ:
  - SQLite データベースを使用。
  - Litestream で定期的に Google Cloud Storage にバックアップ。

### 3.2 非機能要件

- コスト目標:<br>

  - 継続的な運用コストを次 5 円程度に抑える。
  - Google Cloud Run の無料枠（50 万リクエスト/月）を活用。

- パフォーマンス要件:<br>

  - API リクエスト数制限（1 秒あたり 5 リクエスト/ユーザー）内で効率的に動作。
  - キャッシュを活用して API 呼び出し頻度を最小化。

- スケーラビリティ:<br>

  - Cloud Run の自動スケーリングで負荷対応。
  - 最大インスタンス数制限でコスト管理。

- セキュリティ要件:<br>
  - OAuth 2.0 による Google Calendar API 認証。
  - ユーザーデータの暗号化と安全な保存。

### 4. 開発スケジュール

| フェーズ       | タスク                                        | 期間   |
| -------------- | --------------------------------------------- | ------ |
| 要件定義       | 機能要件・非機能要件の詳細設計                | 1 週間 |
| 設計フェーズ   | システム設計、API 連携設計                    | 2 週間 |
| 開発フェーズ   | 基本機能開発（To-Want 管理、Google 連携/認証など） | 4 週間 |
| テストフェーズ | 単体テスト、結合テスト                        | 2 週間 |
| デプロイ・運用 | Cloud Run へのデプロイと運用開始              | 1 週間 |

### 5. コスト試算

- 初期費用

- 開発環境構築: 無料（ローカル環境 + GCP 無料枠）

- 運用費用
  Google Cloud Run 無料枠: 月 50 万リクエスト無料

- Google Calendar API 利用料: 無料（リクエスト制限内）

- Litestream バックアップ: Google Cloud Storage 利用料（数円程度/月）

- 目標: 月次コスト 5 円程度

### 6. リスクと対策

- API リクエスト数制限超過 キャッシュ導入、効率的な API 呼び出し設計
- データ損失 Litestream による自動バックアップ
- 運用コストが目標を超える可能性 インスタンス数制限、無料枠活用

### 7. 今後の展開

- ユーザーインターフェース改善。
